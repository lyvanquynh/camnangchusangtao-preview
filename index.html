<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Album xem trước</title>

<style>
*{box-sizing:border-box}
body{
    margin:0;
    background:#000;
    color:#fff;
    font-family:Arial,sans-serif;
    overflow:hidden
}
header{
    display:flex;
    align-items:center;
    gap:12px;
    padding:10px 16px;
    background:#111
}
header img{height:36px}
header h1{font-size:18px;margin:0}

#gallery{
    padding:12px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
    gap:12px;
    overflow:auto;
    height:calc(100vh - 56px)
}
.thumb{
    cursor:pointer;
    background:#222;
    border-radius:8px;
    overflow:hidden
}
.thumb img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block
}

#viewer{
    position:fixed;
    inset:0;
    background:#000;
    display:none;
    z-index:100
}
#viewer.active{display:block}

#viewer img{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) scale(1);
    max-width:none;
    max-height:none;
    user-select:none;
    cursor:grab;
    transition:transform .3s ease
}

.nav{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    font-size:40px;
    color:#ccc;
    padding:10px;
    cursor:pointer;
    user-select:none
}
.nav:hover{color:#fff}
#prev{left:10px}
#next{right:10px}

#close{
    position:absolute;
    top:10px;
    right:14px;
    font-size:28px;
    cursor:pointer
}

#counter{
    position:absolute;
    bottom:12px;
    right:16px;
    font-size:14px;
    opacity:.8
}
</style>
</head>

<body>

<header id="header">
    <img src="logo.png" alt="logo">
    <h1>Album xem trước</h1>
</header>

<div id="gallery"></div>

<div id="viewer">
    <div id="close">✕</div>
    <div id="prev" class="nav">◀</div>
    <div id="next" class="nav">▶</div>
    <div id="counter"></div>
    <img id="viewerImg">
</div>

<script>
const totalImages = 20
const gallery = document.getElementById('gallery')
const viewer = document.getElementById('viewer')
const viewerImg = document.getElementById('viewerImg')
const counter = document.getElementById('counter')
const header = document.getElementById('header')

let index = 0
let scale = 1
let x = 0, y = 0
let dragging = false
let startX, startY

for(let i=1;i<=totalImages;i++){
    const num = String(i).padStart(2,'0')
    const div = document.createElement('div')
    div.className='thumb'
    div.innerHTML=`<img src="images/${num}.jpg">`
    div.onclick=()=>openViewer(i-1)
    gallery.appendChild(div)
}

function openViewer(i){
    index=i
    viewer.classList.add('active')
    header.style.display='none'
    gallery.style.display='none'
    resetTransform()
    loadImage()
}

function closeViewer(){
    viewer.classList.remove('active')
    header.style.display='flex'
    gallery.style.display='grid'
}

function loadImage(dir=0){
    viewerImg.style.transition='none'
    index=(index+totalImages)%totalImages
    viewerImg.src=`images/${String(index+1).padStart(2,'0')}.jpg`
    counter.textContent=`${index+1}/${totalImages}`
    requestAnimationFrame(()=>{
        viewerImg.style.transition='transform .3s ease'
    })
}

function resetTransform(){
    scale=1;x=0;y=0
    updateTransform()
}

function updateTransform(){
    viewerImg.style.transform=
    `translate(calc(-50% + ${x}px), calc(-50% + ${y}px)) scale(${scale})`
}

document.getElementById('close').onclick=closeViewer
document.getElementById('prev').onclick=()=>{resetTransform();index--;loadImage()}
document.getElementById('next').onclick=()=>{resetTransform();index++;loadImage()}

document.addEventListener('keydown',e=>{
    if(!viewer.classList.contains('active'))return
    if(e.key==='ArrowLeft'){resetTransform();index--;loadImage()}
    if(e.key==='ArrowRight'){resetTransform();index++;loadImage()}
    if(e.key==='Escape')closeViewer()
})

viewerImg.addEventListener('wheel',e=>{
    e.preventDefault()
    scale+=e.deltaY*-0.001
    scale=Math.min(Math.max(1,scale),5)
    updateTransform()
},{passive:false})

viewerImg.addEventListener('mousedown',e=>{
    if(scale<=1)return
    dragging=true
    startX=e.clientX-x
    startY=e.clientY-y
    viewerImg.style.cursor='grabbing'
})

window.addEventListener('mouseup',()=>{
    dragging=false
    viewerImg.style.cursor='grab'
})

window.addEventListener('mousemove',e=>{
    if(!dragging)return
    x=e.clientX-startX
    y=e.clientY-startY
    updateTransform()
})

// Touch
let tStartDist=0
viewerImg.addEventListener('touchstart',e=>{
    if(e.touches.length===2){
        tStartDist=Math.hypot(
            e.touches[0].clientX-e.touches[1].clientX,
            e.touches[0].clientY-e.touches[1].clientY
        )
    }
    if(e.touches.length===1 && scale>1){
        dragging=true
        startX=e.touches[0].clientX-x
        startY=e.touches[0].clientY-y
    }
},{passive:false})

viewerImg.addEventListener('touchmove',e=>{
    e.preventDefault()
    if(e.touches.length===2){
        const d=Math.hypot(
            e.touches[0].clientX-e.touches[1].clientX,
            e.touches[0].clientY-e.touches[1].clientY
        )
        scale*=d/tStartDist
        scale=Math.min(Math.max(1,scale),5)
        tStartDist=d
        updateTransform()
    }
    if(dragging && e.touches.length===1){
        x=e.touches[0].clientX-startX
        y=e.touches[0].clientY-startY
        updateTransform()
    }
},{passive:false})

viewerImg.addEventListener('touchend',()=>dragging=false)
</script>

</body>
</html>
