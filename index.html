<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Album Viewer</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
}

#album {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 10px;
  padding: 10px;
}

#album img {
  width: 100%;
  cursor: pointer;
  border-radius: 6px;
}

#viewer {
  position: fixed;
  inset: 0;
  background: black;
  display: none;
  z-index: 999;
  touch-action: none;
}

#imageWrap {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.slide {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.45s ease;
}

.slide img {
  max-width: 100%;
  max-height: 100%;
  transform-origin: center center;
  transition: transform 0.25s ease;
  user-select: none;
  pointer-events: none;
}

#closeBtn {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 30px;
  color: white;
  cursor: pointer;
  z-index: 10;
}

#counter {
  position: absolute;
  bottom: 15px;
  left: 50%;
  transform: translateX(-50%);
  color: white;
  font-size: 14px;
  z-index: 10;
}
</style>
</head>

<body>

<div id="album"></div>

<div id="viewer">
  <div id="closeBtn">✕</div>
  <div id="imageWrap"></div>
  <div id="counter"></div>
</div>

<script>
const totalImages = 20
const album = document.getElementById('album')
const viewer = document.getElementById('viewer')
const imageWrap = document.getElementById('imageWrap')
const closeBtn = document.getElementById('closeBtn')
const counter = document.getElementById('counter')

let index = 0
let currentSlide = null

let scale = 1
let x = 0
let y = 0
let dragging = false
let startX = 0
let startY = 0

// tạo album
for (let i = 1; i <= totalImages; i++) {
  const img = document.createElement('img')
  img.src = `images/${String(i).padStart(2, '0')}.jpg`
  img.onclick = () => openViewer(i - 1)
  album.appendChild(img)
}

function openViewer(i) {
  index = i
  viewer.style.display = 'block'
  imageWrap.innerHTML = ''
  currentSlide = null
  showImage(index, 0)
}

closeBtn.onclick = () => {
  viewer.style.display = 'none'
  imageWrap.innerHTML = ''
}

function showImage(i, dir) {
  const num = String(i + 1).padStart(2, '0')

  const slide = document.createElement('div')
  slide.className = 'slide'
  slide.style.transform = `translateX(${dir * 100}%)`

  const img = document.createElement('img')
  img.src = `images/${num}.jpg`

  slide.appendChild(img)
  imageWrap.appendChild(slide)

  requestAnimationFrame(() => {
    slide.style.transform = 'translateX(0)'
  })

  if (currentSlide) {
    currentSlide.style.transform = `translateX(${-dir * 100}%)`
    setTimeout(() => currentSlide.remove(), 450)
  }

  currentSlide = slide
  resetTransform()
  counter.textContent = `${index + 1}/${totalImages}`
}

function next() {
  index = (index + 1) % totalImages
  showImage(index, 1)
}

function prev() {
  index = (index - 1 + totalImages) % totalImages
  showImage(index, -1)
}

function resetTransform() {
  scale = 1
  x = 0
  y = 0
  updateTransform()
}

function updateTransform() {
  if (!currentSlide) return
  const img = currentSlide.querySelector('img')
  img.style.transform = `translate(${x}px, ${y}px) scale(${scale})`
}

// chuột
viewer.addEventListener('wheel', e => {
  e.preventDefault()
  scale += e.deltaY < 0 ? 0.1 : -0.1
  scale = Math.min(Math.max(scale, 1), 4)
  updateTransform()
}, { passive: false })

viewer.addEventListener('mousedown', e => {
  if (scale === 1) return
  dragging = true
  startX = e.clientX - x
  startY = e.clientY - y
})

window.addEventListener('mousemove', e => {
  if (!dragging) return
  x = e.clientX - startX
  y = e.clientY - startY
  updateTransform()
})

window.addEventListener('mouseup', () => dragging = false)

// touch
let startDist = 0

viewer.addEventListener('touchstart', e => {
  if (e.touches.length === 2) {
    startDist = getDist(e.touches)
  }
  if (e.touches.length === 1 && scale > 1) {
    dragging = true
    startX = e.touches[0].clientX - x
    startY = e.touches[0].clientY - y
  }
})

viewer.addEventListener('touchmove', e => {
  e.preventDefault()
  if (e.touches.length === 2) {
    const dist = getDist(e.touches)
    scale *= dist / startDist
    scale = Math.min(Math.max(scale, 1), 4)
    startDist = dist
    updateTransform()
  }
  if (dragging && e.touches.length === 1) {
    x = e.touches[0].clientX - startX
    y = e.touches[0].clientY - startY
    updateTransform()
  }
}, { passive: false })

viewer.addEventListener('touchend', () => dragging = false)

function getDist(t) {
  return Math.hypot(
    t[0].clientX - t[1].clientX,
    t[0].clientY - t[1].clientY
  )
}

// vuốt đổi ảnh
let swipeStartX = 0

viewer.addEventListener('touchstart', e => {
  if (e.touches.length === 1 && scale === 1) {
    swipeStartX = e.touches[0].clientX
  }
})

viewer.addEventListener('touchend', e => {
  if (scale > 1) return
  const dx = e.changedTouches[0].clientX - swipeStartX
  if (dx > 60) prev()
  if (dx < -60) next()
})

// phím
window.addEventListener('keydown', e => {
  if (viewer.style.display !== 'block') return
  if (e.key === 'ArrowRight') next()
  if (e.key === 'ArrowLeft') prev()
  if (e.key === 'Escape') closeBtn.click()
})
</script>

</body>
</html>
